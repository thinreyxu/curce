<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anime.js test</title>
  <style>
    #container {
      position: relative;
    }
    #box {
      width: 6px;
      height: 6px;
      margin: -3px;
      background: red;
      border-radius: 50%;
      position: absolute;
    }
    #canvas {
      border: solid 1px #999;
    }
  </style>
</head>
<body>
  <select name="" id="select_easing">
    <optgroup label="Linear">
      <option value="" selected>linear</option>
    </optgroup>
    <optgroup label="Quad">
    <option value="">easeInQuad</option>
    <option value="">easeOutQuad</option>
    <option value="">easeInOutQuad</option>
    </optgroup>
    <optgroup label="Cubic">
    <option value="">easeInCubic</option>
    <option value="">easeOutCubic</option>
    <option value="">easeInOutCubic</option>
    </optgroup>
    <optgroup label="Quart">
    <option value="">easeInQuart</option>
    <option value="">easeOutQuart</option>
    <option value="">easeInOutQuart</option>
    </optgroup>
    <optgroup label="Quint">
    <option value="">easeInQuint</option>
    <option value="">easeOutQuint</option>
    <option value="">easeInOutQuint</option>
    </optgroup>
    <optgroup label="Sine">
    <option value="">easeInSine</option>
    <option value="">easeOutSine</option>
    <option value="">easeInOutSine</option>
    </optgroup>
    <optgroup label="Circ">
    <option value="">easeInCirc</option>
    <option value="">easeOutCirc</option>
    <option value="">easeInOutCirc</option>
    </optgroup>
    <optgroup label="Expo">
    <option value="">easeInExpo</option>
    <option value="">easeOutExpo</option>
    <option value="">easeInOutExpo</option>
    </optgroup>
    <optgroup label="Elastic">
    <option value="">easeInElastic</option>
    <option value="">easeOutElastic</option>
    <option value="">easeInOutElastic</option>
    </optgroup>
    <optgroup label="Back">
    <option value="">easeInBack</option>
    <option value="">easeOutBack</option>
    <option value="">easeInOutBack</option>
    </optgroup>
    <optgroup label="Bounce">
    <option value="">easeInBounce</option>
    <option value="">easeOutBounce</option>
    <option value="">easeInOutBounce</option>
    </optgroup>
  </select>
  <select name="" id="select_duration">
    <option value="">100</option>
    <option value="">300</option>
    <option value="">600</option>
    <option value="">1000</option>
    <option value="" selected>2000</option>
    <option value="">5000</option>
    <option value="">10000</option>
    <option value="">20000</option>
  </select>
  <button id='btn_redraw'>redraw</button>
  <div id="container">
    <div id="box"></div>
    <canvas id='canvas' width="1200" height="600"></canvas>
  </div>

  <script src="../../src/anime.js"></script>
  <script>
    window.onload = function () {
      var easingSel = document.getElementById('select_easing'),
          durationSel = document.getElementById('select_duration'),
          redrawBtn = document.getElementById('btn_redraw');
      var easing = easingSel.options[easingSel.selectedIndex].text,
          duration = durationSel.options[durationSel.selectedIndex].text;
      var canvas = document.getElementById('canvas');
      var tween;

      draw(canvas, easing, duration);

      redrawBtn.onclick = function () {
        draw(canvas, easing, duration);
      };

      easingSel.onchange = function () {
        easing = this.options[this.selectedIndex].text;
        draw(canvas, easing, duration);
      };

      durationSel.onchange = function () {
        duration = this.options[this.selectedIndex].text;
        draw(canvas, easing, duration);
      };

      function draw (canvas, easing, duration) {
        easing = easing || 'linear';
        duration = duration ? parseInt(duration, 10) : 2000;

        tween && tween.stop();

        var box = document.getElementById('box');
        var width = canvas.width,
            height = canvas.height;
        var gd = canvas.getContext('2d');
        var x = 100, y = 100;
        
        box.style.left = x - 20 + 'px';
        box.style.top = height - y + 'px';
        
        gd.clearRect(0, 0, width, height);

        gd.strokeStyle = '#f2f2f2';
        gd.lineWidth = '1';
        gd.lineCap = 'round';
        gd.lineJoin = 'round';

        // 画格线
        gd.beginPath();
        for (var i = 1; i < width / 10; i++) {
          gd.moveTo(i * 10 + 0.5, 0);
          gd.lineTo(i * 10 + 0.5, height);
        }
        for (var i = 1; i < height / 10; i++) {
          gd.moveTo(0, i * 10 + 0.5);
          gd.lineTo(width, i * 10 + 0.5);
        }
        gd.stroke();
        
        // 画绘图区
        gd.beginPath();
        gd.strokeStyle = '#ccc';
        gd.strokeRect(x - 9.5, y - 9.5, width - 2 * x + 20, height - 2 * y + 20);
        gd.fillStyle = '#fff';
        gd.fillRect(x - 9.5, y - 9.5, width - 2 * x + 20, height - 2 * y + 20);
        
        for (var i = 1; i < (width - 2 * x + 20) / 10 ; i++) {
          for (var j = 1; j < (height - 2 * y + 20) / 10; j++) {
            gd.fillStyle = '#ccc';
            gd.fillRect(i * 10 + x - 10, j * 10 + x - 10, 1, 1);
          }
        }

        // 画文字
        gd.fillStyle = '#333';
        gd.font = '14px serif';
        gd.fillText(easing + ' ' + duration + 'ms', 20, 40);

        // 动画
        tween = anime({
          begin: {x: 0, y: 0},
          end: {x: width - 2 * x, y: height - 2 * y},
          easing: {y: easing},
          duration: duration,
          delay: 1000,
        })
        .onstart(function (current) {
          console.clear();
          console.log('start');
          console.log(this._current);
          gd.beginPath();
          gd.moveTo(current.x + x, height - current.y - y);
          gd.strokeStyle = '#0d9';
          gd.lineWidth = '2';
        })
        .onupdate(function (current) {
          console.log(this._current);
          gd.lineTo(current.x + x, height - current.y - y);
          gd.stroke();
          box.style.top = height - current.y - y + 'px';
        })
        .oncomplete(function (current) {
          console.log('end');
        })
        .start();
      }
    };
  </script>
</body>
</html>